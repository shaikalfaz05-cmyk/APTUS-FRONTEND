<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Aptus — Personal AI Stylist (Demo)</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#050505;
      --accent1:#6b21a8;
      --accent2:#2563eb;
      --gold:#D4AF37;
      --gold-dark:#B8860B;
      --glass: rgba(255,255,255,0.03);
      --muted: rgba(230,235,255,0.78);
    }
    html,body{height:100%;margin:0;background:var(--bg);font-family:Poppins,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;color:#eef2ff;-webkit-font-smoothing:antialiased;}
    body::before{
      content:""; position:fixed; inset:0; z-index:-3;
      background:
        radial-gradient(700px 520px at 8% 18%, rgba(107,33,168,0.14), transparent 18%),
        radial-gradient(650px 480px at 85% 82%, rgba(37,99,235,0.10), transparent 20%),
        linear-gradient(180deg, rgba(5,5,7,1), rgba(5,5,7,1));
      pointer-events:none; filter: blur(20px);
    }

    .app { min-height:100vh; display:flex; align-items:center; justify-content:center; padding:28px; }
    .card { width:980px; max-width:calc(100% - 40px); border-radius:18px; padding:26px; background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border:1px solid rgba(255,255,255,0.04); box-shadow: 0 18px 60px rgba(2,6,23,0.7); backdrop-filter: blur(20px); position:relative; }

    .brand { display: flex; align-items: center; justify-content: space-between; gap: 12px; }

    .brand-left { display:flex; gap:14px; align-items:center; }
    .logo-embed { width:64px; height:64px; border-radius:12px; display:flex; align-items:center; justify-content:center; background: linear-gradient(135deg,var(--gold),var(--gold-dark)); box-shadow:0 10px 30px rgba(212,175,55,0.08); padding:8px; }
    .brand-title { font-family:'Playfair Display',serif; font-size:20px; font-weight:700; color:white; }
    .brand-tag { color:var(--muted); font-size:13px; }

    .screen { display:none; opacity:0; transform: translateY(8px) scale(.98); transition: all 320ms cubic-bezier(.2,.9,.28,1); }
    .screen.active { display:block; opacity:1; transform: translateY(0) scale(1); }

    .glass { background: var(--glass); border-radius:12px; border:1px solid rgba(255,255,255,0.04); padding:12px; }

    .btn { border-radius:12px; padding:10px 14px; border:1px solid rgba(255,255,255,0.04); background: rgba(255,255,255,0.02); color:#eaf0ff; cursor:pointer; font-family:Poppins, sans-serif; }
    .btn-gold { background: linear-gradient(90deg,var(--gold),var(--gold-dark)); color:#071019; border:none; font-weight:700; box-shadow: 0 10px 30px rgba(212,175,55,0.08); }
    .btn-accent { background: linear-gradient(90deg, rgba(107,33,168,0.10), rgba(37,99,235,0.10)); border:1px solid rgba(124,58,237,0.12); }
    .btn:hover{ transform: translateY(-3px); transition: transform .18s ease; }

    .oc-grid { display:grid; grid-template-columns: repeat(2,1fr); gap:14px; }
    .oc-btn{ padding:18px; border-radius:12px; min-height:98px; display:flex; align-items:center; justify-content:center; text-align:center; font-weight:700; letter-spacing:.2px; font-size:16px; }

    .warn-title { color:var(--gold); font-weight:700; font-size:15px; margin-top:10px; }
    .warn-text { color:var(--gold); font-weight:700; font-size:14px; margin-top:6px; }

    .carousel { display:flex; gap:14px; overflow-x:auto; padding-bottom:6px; -webkit-overflow-scrolling:touch; }
    .look { min-width:320px; flex:0 0 320px; border-radius:12px; padding:12px; background: linear-gradient(180deg, rgba(255,255,255,0.015), rgba(255,255,255,0.01)); border:1px solid rgba(255,255,255,0.03); }
    .item-img { width:100%; height:170px; border-radius:8px; object-fit:cover; background:#111; }

    .modal-backdrop { position:fixed; inset:0; background:rgba(2,6,23,0.6); display:flex; align-items:center; justify-content:center; z-index:80; }
    .modal { background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); padding:18px; border-radius:12px; width:92%; max-width:660px; border:1px solid rgba(255,255,255,0.04); }

    .founder-footer { text-align:center; font-family:Poppins, sans-serif; color: var(--gold); font-size:13px; margin-top:12px; }

    @media (max-width:920px) {
      .card { padding:18px; width:calc(100% - 36px); }
      .look { min-width:260px; flex:0 0 260px; }
      .oc-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="card">
      <div class="brand">
        <div class="brand-left">
          <div class="logo-embed" id="logoTopLeft" style="display:none;" aria-hidden="true">
            <!-- will replace with small embedded logo when login logo is present -->
            <svg width="44" height="44" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" aria-hidden>
              <defs><linearGradient id="gL" x1="0" x2="1"><stop offset="0" stop-color="#E6B980"/><stop offset="1" stop-color="#EACDA3"/></linearGradient></defs>
              <rect width="64" height="64" rx="12" fill="url(#gL)"></rect>
              <path d="M18 46 L26 18 L34 46 Z" fill="#071019"></path>
              <path d="M30 26 L38 26 L32 42 Z" fill="url(#gL)"></path>
            </svg>
          </div>
          <div>
            <div class="brand-title">Aptus</div>
            <div class="brand-tag">The Future of Style is Personal</div>
          </div>
        </div>
        <div id="profileQuickBtn" style="display:none;">
          <button id="openEdit" class="btn btn-accent">Profile</button>
        </div>
      </div>

      <div id="screens" style="margin-top:18px;">

        <!-- LOGIN (Home) -->
        <section id="screen-login" class="screen active" aria-hidden="false">
          <div style="text-align:center; padding:26px 12px;">
            <div style="display:flex;align-items:center;justify-content:center;margin-bottom:14px;">
              <!-- IMPORTANT: Paste your base64 data URI here (from /mnt/data/aptus_logo_datauri.txt).
                   Replace DATA_URI_FOR_YOUR_LOGO_HERE with the full data URI string: data:image/png;base64,... -->
              <img id="loginLogo" src=/mnt/data/aptus_logo_datauri.txt alt="Aptus logo" style="width:160px;height:160px;border-radius:18px;object-fit:cover;box-shadow:0 18px 60px rgba(212,175,55,0.08);" />
            </div>

            <h1 style="font-family:'Playfair Display'; font-size:36px; margin-bottom:6px; color:white;">Aptus</h1>
            <p class="brand-tag" style="margin-bottom:18px;">The Future of Style is Personal</p>

            <div style="max-width:420px;margin:0 auto;">
              <button id="btnSignIn" class="btn btn-gold w-full py-3" style="font-size:16px;">Sign in with Google</button>
              <p class="muted" style="margin-top:10px;font-size:13px;">Simulated sign-in for demo purposes</p>
            </div>
          </div>

          <div style="margin-top:14px;">
            <div class="founder-footer">Founder: <strong>SK.ALFAZ</strong> &nbsp;|&nbsp; Email: <a href="mailto:shaikalfaz05@gmail.com" style="color:var(--gold) ">shaikalfaz05@gmail.com</a></div>
          </div>
        </section>

        <!-- GENDER -->
        <section id="screen-gender" class="screen" aria-hidden="true">
          <button id="backFromGender" class="btn glass mb-4">← Back</button>
          <div style="text-align:center; padding-top:8px;">
            <h2 style="font-family:'Playfair Display'; font-size:26px;">Welcome, <span id="userName">Guest</span>!</h2>
            <p class="muted" style="margin-bottom:18px;">I'm styling for...</p>

            <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px; max-width:640px; margin:0 auto;">
              <button class="btn btn-accent oc-btn" data-gender="Men">Men</button>
              <button class="btn btn-accent oc-btn" data-gender="Women">Women</button>
            </div>
          </div>
        </section>

        <!-- PROFILE CREATION -->
        <section id="screen-profile" class="screen" aria-hidden="true">
          <button id="backFromProfile" class="btn glass mb-4">← Back</button>
          <div style="max-width:720px; margin:8px auto 0;">
            <h2 style="font-family:'Playfair Display'; font-size:22px;">Create your profile</h2>
            <p class="muted">Height, weight and quick skin-tone scan</p>

            <div style="margin-top:12px; display:grid; gap:10px;">
              <div>
                <label class="muted" style="font-size:13px">Height (cm)</label>
                <input id="heightInput" type="number" placeholder="e.g. 175" class="glass w-full mt-2 p-3 rounded" />
              </div>

              <div>
                <label class="muted" style="font-size:13px">Weight (kg)</label>
                <input id="weightInput" type="number" placeholder="e.g. 68" class="glass w-full mt-2 p-3 rounded" />
              </div>

              <div>
                <label class="muted" style="font-size:13px">Skin Tone Scan</label>
                <div style="display:flex; gap:10px; align-items:center; margin-top:8px;">
                  <button id="btnScan" class="btn btn-accent">Upload Selfie & Scan</button>
                  <div id="scanStatus" class="muted">No result</div>
                </div>
                <div class="warn-title">⚠️ Important — follow these steps for accurate results</div>
                <div class="warn-text">For best results: no specs, no makeup, natural daylight.</div>
              </div>

              <div>
                <button id="btnContinue" class="btn btn-gold w-full opacity-60 cursor-not-allowed" disabled>Continue</button>
              </div>
            </div>
          </div>
        </section>

        <!-- OCCASION -->
        <section id="screen-occasion" class="screen" aria-hidden="true">
          <div style="display:flex; justify-content:space-between; align-items:center;">
            <div>
              <h2 style="font-family:'Playfair Display'; font-size:22px;">For Which Occasion?</h2>
              <p class="muted">Pick an occasion and we'll craft outfit ideas</p>
            </div>
            <div>
              <button id="profileIcon" class="btn glass">Profile</button>
            </div>
          </div>

          <div style="margin-top:18px; display:grid; grid-template-columns:repeat(2,1fr); gap:12px;">
            <button class="btn oc-btn" data-oc="Date">Date</button>
            <button class="btn oc-btn" data-oc="Marriage">Marriage</button>
            <button class="btn oc-btn" data-oc="Party">Party</button>
            <button class="btn oc-btn" data-oc="Office">Office</button>
            <button class="btn oc-btn col-span-2" data-oc="College">College</button>
          </div>
        </section>

        <!-- OUTFITS -->
        <section id="screen-outfit" class="screen" aria-hidden="true">
          <button id="backFromOutfits" class="btn glass mb-3">← Back</button>
          <div style="display:flex; justify-content:space-between; align-items:center;">
            <div>
              <h2 id="outfitTitle" style="font-family:'Playfair Display'; font-size:22px;"></h2>
              <p id="outfitSub" class="muted mt-1">Your curated looks</p>
            </div>
            <div>
              <button id="aiTipsBtn" class="btn btn-accent">✨ Get AI Styling Tips</button>
            </div>
          </div>

          <div id="loadingArea" class="muted mt-4">🧠 Aptus AI is thinking...</div>

          <div id="carouselWrap" class="mt-6" style="display:none;">
            <div class="carousel" id="carousel"></div>

            <div style="display:flex; gap:10px; margin-top:14px; align-items:center;">
              <button id="prevOutfit" class="btn glass">← Prev</button>
              <button id="nextOutfit" class="btn glass">Next →</button>
              <div style="flex:1"></div>
              <button id="shopAllBtn" class="btn btn-gold">Shop Now</button>
            </div>
          </div>
        </section>

        <!-- EDIT PROFILE -->
        <section id="screen-edit" class="screen" aria-hidden="true">
          <button id="backFromEdit" class="btn glass mb-4">← Back</button>
          <div style="max-width:640px; margin:8px auto;">
            <h2 style="font-family:'Playfair Display';font-size:22px;">Edit Profile</h2>
            <div class="muted" style="margin-top:6px;">Modify Height, Weight, or re-scan your skin tone</div>

            <div style="margin-top:12px; display:grid; gap:8px;">
              <label class="muted" style="font-size:13px">Height (cm)</label>
              <input id="editHeight" type="number" class="glass p-3 rounded" />
              <label class="muted" style="font-size:13px">Weight (kg)</label>
              <input id="editWeight" type="number" class="glass p-3 rounded" />

              <div style="display:flex; gap:8px;">
                <button id="genderMenEdit" class="btn btn-accent">Men</button>
                <button id="genderWomenEdit" class="btn btn-accent">Women</button>
              </div>

              <div style="display:flex; gap:8px; align-items:center;">
                <div id="currentToneDisplay" class="muted">Detected Tone: -</div>
                <button id="btnRescan" class="btn btn-accent">Re-Scan</button>
                <div id="rescanInfo" class="muted ml-auto">Last: Never</div>
              </div>

              <div style="display:flex; gap:8px; margin-top:8px;">
                <button id="saveEditBtn" class="btn btn-gold ml-auto">Save & Refresh</button>
                <button id="feedFromEdit" class="btn glass">Feedback & Support</button>
              </div>
            </div>
          </div>
        </section>

        <!-- FEEDBACK -->
        <section id="screen-feedback" class="screen" aria-hidden="true">
          <button id="backFromFeedback" class="btn glass mb-4">← Back</button>
          <div style="max-width:640px;margin:12px auto;">
            <h2 style="font-family:'Playfair Display';font-size:22px;">Send Feedback</h2>
            <div class="muted" style="margin-top:6px;">Have an idea or a problem? Please contact us directly at: <a href="mailto:shaikalfaz05@gmail.com" style="color:var(--gold) ">shaikalfaz05@gmail.com</a></div>

            <div style="margin-top:12px;">
              <label class="muted" style="font-size:13px">Your message</label>
              <textarea id="feedbackText" class="glass w-full mt-2 p-3 rounded" rows="5" placeholder="Write your feedback..."></textarea>
              <button id="submitFeedbackBtn" class="btn btn-gold w-full mt-3">Submit Feedback</button>
              <div id="feedbackThanks" class="muted mt-3" style="display:none;">Thank you — your feedback has been recorded!</div>
            </div>
          </div>
        </section>

      </div>
    </div>
  </div>

  <div id="modalRoot" style="display:none;"></div>

<script>
/* =============
  Aptus single-file front-end (simulation mode)
  - Paste your logo data URI into loginLogo/src as noted above.
  - Firebase config is pre-populated below. For real production, store keys safely on the server.
============= */

/* ---- Firebase placeholder (already filled from your upload) ----
   If you later want to replace or remove, update values or remove the initialization.
   NOTE: For production, do NOT expose secret keys publicly. Use server-side auth instead.
*/
const firebaseConfig = {
  apiKey: "AIzaSyB2fuNSxdE9alHFj7ogXnYRv3ozsLEpV1k",
  authDomain: "aptus-ai-4eb75.firebaseapp.com",
  projectId: "aptus-ai-4eb75",
  storageBucket: "aptus-ai-4eb75.appspot.com",
  messagingSenderId: "1080954249117",
  appId: "1:1080954249117:web:4540850827ed9ff1925974",
  measurementId: "G-QYFKM8PC9J"
};
/* Firebase SDK optional init (commented out — only if you include Firebase scripts)
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-analytics.js";
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
*/

// Cloud AI key placeholder (you provided earlier)
const CLOUD_AI_KEY = "AIzaSyCPFY5V6UFT8Tso3FmX4PjdjMI4iuHQ3Xo"; // keep secret in production

// backend URL (Phase 1 expects local Flask server). Update to your live API when ready.
const API_URL = "http://127.0.0.1:5000/get-outfit";

/* ---------- App State & Utilities ---------- */
const state = {
  profile: { name: 'Guest', gender: null, height: null, weight: null, skinTone: null },
  currentOccasion: null,
  outfits: [],
  outfitIndex: 0
};

const SCREENS = {
  login: document.getElementById('screen-login'),
  gender: document.getElementById('screen-gender'),
  profile: document.getElementById('screen-profile'),
  occasion: document.getElementById('screen-occasion'),
  outfits: document.getElementById('screen-outfit'),
  edit: document.getElementById('screen-edit'),
  feedback: document.getElementById('screen-feedback'),
};

function showScreen(key) {
  Object.values(SCREENS).forEach(s => s.classList.remove('active'));
  if (SCREENS[key]) SCREENS[key].classList.add('active');
  // show/hide top-left logo & quick profile
  const logoTop = document.getElementById('logoTopLeft');
  const profileQuick = document.getElementById('profileQuickBtn');
  if (['occasion','outfits','edit'].includes(key)) {
    logoTop.style.display = 'flex';
    profileQuick.style.display = 'block';
    const lg = document.getElementById('loginLogo');
    if (lg && lg.src && lg.src.startsWith('data:image')) {
      logoTop.innerHTML = `<img src="${lg.src}" alt="logo" style="width:44px;height:44px;border-radius:8px;object-fit:cover;"/>`;
    }
  } else {
    logoTop.style.display = 'none';
    profileQuick.style.display = 'none';
  }
}

/* ---------- Startup ---------- */
document.addEventListener('DOMContentLoaded', () => {
  const raw = localStorage.getItem('aptus_profile_v1');
  if (raw) {
    try { state.profile = JSON.parse(raw); document.getElementById('userName').textContent = state.profile.name || 'Guest'; } catch(e){}
  }
  showScreen('login');
});

/* ---------- Login ---------- */
document.getElementById('btnSignIn').addEventListener('click', () => {
  const btn = document.getElementById('btnSignIn');
  btn.disabled = true; btn.textContent = 'Signing in...';
  setTimeout(() => {
    btn.disabled = false; btn.textContent = 'Sign in with Google';
    const name = prompt('Enter your name (demo):', state.profile.name || 'Guest');
    state.profile.name = name && name.trim() ? name.trim() : 'Guest';
    localStorage.setItem('aptus_profile_v1', JSON.stringify(state.profile));
    document.getElementById('userName').textContent = state.profile.name;
    showScreen('gender');
  }, 900);
});

/* ---------- Gender ---------- */
document.querySelectorAll('[data-gender]').forEach(b => {
  b.addEventListener('click', (e) => {
    state.profile.gender = e.currentTarget.getAttribute('data-gender');
    localStorage.setItem('aptus_profile_v1', JSON.stringify(state.profile));
    showScreen('profile');
  });
});
document.getElementById('backFromGender').addEventListener('click', () => showScreen('login'));

/* ---------- Profile creation ---------- */
const heightInput = document.getElementById('heightInput');
const weightInput = document.getElementById('weightInput');
const scanStatus = document.getElementById('scanStatus');
const btnScan = document.getElementById('btnScan');
const btnContinue = document.getElementById('btnContinue');

function checkContinue() {
  const h = heightInput.value && heightInput.value.trim();
  const w = weightInput.value && weightInput.value.trim();
  const t = state.profile.skinTone;
  if (h && w && t) { btnContinue.disabled = false; btnContinue.classList.remove('opacity-60','cursor-not-allowed'); } 
  else { btnContinue.disabled = true; btnContinue.classList.add('opacity-60','cursor-not-allowed'); }
}
heightInput.addEventListener('input', checkContinue);
weightInput.addEventListener('input', checkContinue);

btnScan.addEventListener('click', () => {
  btnScan.disabled = true; scanStatus.textContent = 'Analyzing...';
  setTimeout(() => {
    const tones = ['Warm','Cool','Neutral'];
    const pick = tones[Math.floor(Math.random()*tones.length)];
    state.profile.skinTone = pick; scanStatus.textContent = 'Detected: ' + pick;
    btnScan.disabled = false;
    localStorage.setItem('aptus_profile_v1', JSON.stringify(state.profile));
    checkContinue();
  }, 1500);
});

btnContinue.addEventListener('click', () => {
  state.profile.height = Number(heightInput.value) || null;
  state.profile.weight = Number(weightInput.value) || null;
  localStorage.setItem('aptus_profile_v1', JSON.stringify(state.profile));
  showScreen('occasion');
});
document.getElementById('backFromProfile').addEventListener('click', () => showScreen('gender'));

/* ---------- Occasion ---------- */
document.querySelectorAll('[data-oc]').forEach(btn => btn.addEventListener('click', (e) => {
  const occ = e.currentTarget.getAttribute('data-oc');
  loadOutfitsFromServer(occ);
}));
document.getElementById('profileIcon').addEventListener('click', ()=> {
  document.getElementById('editHeight').value = state.profile.height || '';
  document.getElementById('editWeight').value = state.profile.weight || '';
  document.getElementById('currentToneDisplay').textContent = 'Detected Tone: ' + (state.profile.skinTone || '-');
  showScreen('edit');
});

/* ---------- Outfits: fetch from backend ---------- */
const loadingArea = document.getElementById('loadingArea');
const carouselWrap = document.getElementById('carouselWrap');
const carousel = document.getElementById('carousel');

async function loadOutfitsFromServer(occasion) {
  if (!state.profile.gender || !state.profile.skinTone) {
    alert('Complete your profile (gender & skin tone) first.');
    return;
  }
  state.currentOccasion = occasion;
  document.getElementById('outfitTitle').textContent = `${occasion} • ${state.profile.gender}`;
  showScreen('outfits');
  loadingArea.textContent = '🧠 Aptus AI is thinking...';
  carouselWrap.style.display = 'none';

  try {
    // simulated delay
    await new Promise(r => setTimeout(r, 700 + Math.random()*700));
    // call backend (expects Flask at 127.0.0.1:5000)
    const resp = await fetch(API_URL, {
      method:'POST',
      headers:{ 'Content-Type':'application/json' },
      body: JSON.stringify({ gender: state.profile.gender, skinTone: state.profile.skinTone, occasion })
    });
    const json = await resp.json();
    if (!json.success) { loadingArea.textContent = 'Server error: ' + (json.error || 'unknown'); return; }
    state.outfits = json.outfits || [];
    if (state.outfits.length === 0) { loadingArea.textContent = 'No outfits found for your selection.'; return; }
    loadingArea.textContent = '';
    carouselWrap.style.display = 'block';
    populateCarousel();
  } catch (e) {
    loadingArea.textContent = 'Network error — is the backend server running?';
    console.error(e);
  }
}

function populateCarousel() {
  carousel.innerHTML = '';
  state.outfits.forEach((outfit, i) => {
    const el = document.createElement('div');
    el.className = 'look';
    el.innerHTML = `
      <div style="font-family:'Playfair Display';font-weight:700;font-size:16px;">${escapeHtml(outfit.title)}</div>
      <div class="muted" style="margin-top:6px;">${escapeHtml(outfit.description)}</div>
      <div style="margin-top:10px; display:grid; grid-template-columns:repeat(3,1fr); gap:8px;">
        ${outfit.items.map(it => `
          <div style="text-align:center;">
            <img src="${it.image}" alt="${escapeHtml(it.name)}" class="item-img" />
            <div class="muted" style="margin-top:8px">${escapeHtml(it.name)}</div>
            <a href="${it.link||'#'}" class="muted" onclick="event.preventDefault();">Shop Now</a>
          </div>
        `).join('')}
      </div>
    `;
    carousel.appendChild(el);
  });
  state.outfitIndex = 0;
  showOutfitIndex(0);
}

function showOutfitIndex(idx) {
  if (!state.outfits || state.outfits.length === 0) return;
  const total = state.outfits.length;
  if (idx < 0) idx = total - 1;
  if (idx >= total) idx = 0;
  state.outfitIndex = idx;
  const child = carousel.children[idx];
  if (child) carousel.scrollTo({ left: child.offsetLeft - carousel.offsetLeft, behavior: 'smooth' });
}

document.getElementById('prevOutfit').addEventListener('click', ()=> showOutfitIndex(state.outfitIndex - 1));
document.getElementById('nextOutfit').addEventListener('click', ()=> showOutfitIndex(state.outfitIndex + 1));
document.getElementById('backFromOutfits').addEventListener('click', ()=> showScreen('occasion'));

/* ---------- AI Tips (simulated) ---------- */
document.getElementById('aiTipsBtn').addEventListener('click', ()=> {
  showModal('AI Styling Tips', '<div style="padding:8px">Analyzing outfit and skin tone...</div>');
  setTimeout(()=> {
    const tip = generateTip();
    updateModalContent(`<div style="padding:8px">${tip}</div>`);
  }, 900);
});

function generateTip() {
  const tone = state.profile.skinTone || 'Neutral';
  let base = `This recommendation suits ${state.profile.gender} for ${state.currentOccasion}. `;
  if (tone === 'Warm') base += "Warm skin tones pair well with gold & earthy accessories.";
  else if (tone === 'Cool') base += "Cool skin tones look excellent with navy, silver, and jewel tones.";
  else base += "Neutral skin tones are flexible — try soft pastels and balanced textures.";
  return base;
}

/* modal */
function showModal(title, html) {
  const root = document.getElementById('modalRoot');
  root.innerHTML = `<div class="modal-backdrop" id="modalBackdrop"><div class="modal"><div style="display:flex;justify-content:space-between;align-items:center;"><strong>${title}</strong><button id="closeModal" class="btn glass">✕</button></div><div id="modalContent" style="margin-top:12px">${html}</div></div></div>`;
  root.style.display = 'block';
  document.getElementById('closeModal').addEventListener('click', closeModal);
  document.getElementById('modalBackdrop').addEventListener('click', (e)=> { if (e.target.id === 'modalBackdrop') closeModal(); });
}
function updateModalContent(html){ const root=document.getElementById('modalRoot'); const c=root.querySelector('#modalContent'); if (c) c.innerHTML = html; }
function closeModal(){ const root=document.getElementById('modalRoot'); root.style.display='none'; root.innerHTML=''; }

/* ---------- Edit profile ---------- */
document.getElementById('openEdit').addEventListener('click', ()=> {
  document.getElementById('editHeight').value = state.profile.height || '';
  document.getElementById('editWeight').value = state.profile.weight || '';
  document.getElementById('currentToneDisplay').textContent = 'Detected Tone: ' + (state.profile.skinTone || '-');
  showScreen('edit');
});

document.getElementById('genderMenEdit').addEventListener('click', ()=> { state.profile.gender = 'Men'; localStorage.setItem('aptus_profile_v1', JSON.stringify(state.profile)); alert('Gender set to Men'); });
document.getElementById('genderWomenEdit').addEventListener('click', ()=> { state.profile.gender = 'Women'; localStorage.setItem('aptus_profile_v1', JSON.stringify(state.profile)); alert('Gender set to Women'); });
document.getElementById('btnRescan').addEventListener('click', ()=> {
  const btn = document.getElementById('btnRescan'); btn.disabled = true; document.getElementById('rescanInfo').textContent = 'Scanning...';
  setTimeout(()=> { const tones=['Warm','Cool','Neutral']; const pick=tones[Math.floor(Math.random()*tones.length)]; state.profile.skinTone = pick; document.getElementById('currentToneDisplay').textContent = 'Detected Tone: ' + pick; document.getElementById('rescanInfo').textContent = 'Last: Just now'; btn.disabled=false; localStorage.setItem('aptus_profile_v1', JSON.stringify(state.profile)); }, 1400);
});
document.getElementById('saveEditBtn').addEventListener('click', ()=> {
  const eh = Number(document.getElementById('editHeight').value) || null;
  const ew = Number(document.getElementById('editWeight').value) || null;
  if (eh) state.profile.height = eh; if (ew) state.profile.weight = ew;
  localStorage.setItem('aptus_profile_v1', JSON.stringify(state.profile));
  alert('Profile updated.'); showScreen('occasion');
});
document.getElementById('feedFromEdit').addEventListener('click', ()=> showScreen('feedback'));
document.getElementById('backFromEdit').addEventListener('click', ()=> showScreen('occasion'));

/* ---------- Feedback ---------- */
document.getElementById('submitFeedbackBtn').addEventListener('click', ()=> {
  const txt = document.getElementById('feedbackText').value.trim();
  if(!txt){ alert('Please write your feedback.'); return; }
  const arr = JSON.parse(localStorage.getItem('aptus_feedbacks_v1') || '[]');
  arr.push({ text: txt, profile: state.profile, time: new Date().toISOString() });
  localStorage.setItem('aptus_feedbacks_v1', JSON.stringify(arr));
  document.getElementById('feedbackThanks').style.display='block';
  setTimeout(()=>{ document.getElementById('feedbackThanks').style.display='none'; document.getElementById('feedbackText').value=''; showScreen('edit'); }, 1200);
});
document.getElementById('backFromFeedback').addEventListener('click', ()=> showScreen('edit'));

/* ---------- Utilities ---------- */
function escapeHtml(str){ if(!str) return ''; return String(str).replace(/[&<>"'`]/g, function(s){ return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;','`':'&#96;'})[s]; }); }
document.addEventListener('keydown', (e)=> { if (SCREENS.outfits.classList.contains('active')) { if (e.key==='ArrowLeft') showOutfitIndex(state.outfitIndex-1); if (e.key==='ArrowRight') showOutfitIndex(state.outfitIndex+1); } });

/* initialize small header logo if login has data URI */
(function init(){ const lg=document.getElementById('loginLogo'); if (lg && lg.src && lg.src.startsWith('data:image')) { document.getElementById('logoTopLeft').style.display='flex'; } document.getElementById('userName').textContent = state.profile.name || 'Guest'; })();
</script>

<!-- Cuelinks script (as you supplied) -->
<script type='text/javascript'>
  var cId = '249546';
  (function(d, t) {
    var s = document.createElement('script');
    s.type = 'text/javascript';
    s.async = true;
    s.src = (document.location.protocol == 'https:' ? 'https://cdn0.cuelinks.com/js/' : 'http://cdn0.cuelinks.com/js/')  + 'cuelinksv2.js';
    document.getElementsByTagName('body')[0].appendChild(s);
  }());
</script>

</body>
</html>
